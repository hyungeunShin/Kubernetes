# Argo Rollouts

### Argo Rollouts(Ver. 1.6.4) 설치

- Docs : https://argoproj.github.io/argo-rollouts/
- Artifact Hub : https://artifacthub.io/packages/helm/argo/argo-rollouts/2.34.1

---

## 1. Argo Rollouts 설치

▶ Dashboard > add-on > deploy-argo > 파라미터와 함께 빌드

```
DEPLOY_TYPE: helm_upgrade
TARGET_ARGO: argocd-rollouts
```

<img src="images/8/1.png" alt="" width="100%">

▶ 설치 확인

<img src="images/8/2.png" alt="" width="100%">

---

## 2. 동작 확인

### 2-1. [+ NEW APP] > [EDIT AS YAML] > [SAVE] > [CREATE]

```yaml
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: api-tester-2233
spec:
  destination:
    name: ''
    namespace: anotherclass-223
    server: 'https://kubernetes.default.svc'
  source:
    path: 2233/deploy/argo-rollouts
    repoURL: 'https://github.com/hyungeunShin/Kubernetes-Sprint2-Config.git'
    targetRevision: main
  sources: []
  project: default
```

<img src="images/8/3.png" alt="" width="100%">

<img src="images/8/4.png" alt="" width="100%">

### 2-2. [SYNC] > [SYNCHRONIZE]

### 2-3. 트래픽 보내기

```
//Active Service
[root@k8s-master ~]# while true; do curl http://192.168.56.30:32233/version; sleep 3; echo '';  done;
[App Version] : Api Tester v1.0.0
[App Version] : Api Tester v1.0.0

//Preview Service
[root@k8s-master ~]# while true; do curl http://192.168.56.30:32243/version; sleep 2; echo '';  done;
[App Version] : Api Tester v1.0.0
[App Version] : Api Tester v1.0.0
```

### 2-4. Git에서 image의 tag 변경 - rollout.yaml

```yaml
    spec:
      nodeSelector:
        kubernetes.io/hostname: k8s-master
      containers:
        - name: api-tester-2233
          image: gusrms0978/api-tester:2.0.0
```

### 2-5. api-tester-2233 > [SYNC] > [SYNCHRONIZE]